<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentalDrive | Premium Vehicle Management</title>
    <style>
        :root { 
            --leather: #885133;    
            --cream: #f4f0ec;      
            --white: #ffffff;      
            --burnt-red: #d62300;  
            --beige: #f0e6d7;      
            
            --text-main: #333333;
            --text-muted: #e0e0e0;
        }

        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--cream); color: var(--text-main); scroll-behavior: smooth; }

        /* AUTHENTICATION OVERLAY */
        #auth-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--leather); 
            z-index: 5000; display: flex; align-items: center; justify-content: center;
        }
        .login-card {
            background: var(--white); padding: 40px; border-radius: 15px; width: 350px; text-align: center; color: var(--text-main);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3); border-top: 5px solid var(--burnt-red);
        }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; background: var(--cream); color: #333; box-sizing: border-box; }
        
        /* HEADER */
        header { background: var(--leather); color: var(--white); padding: 20px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        header h2 { color: var(--beige); margin: 0; font-weight: bold; font-size: 24px; cursor: pointer; letter-spacing: 1px; }
        nav a, .logout-btn { color: var(--text-muted); margin-left: 25px; text-decoration: none; font-size: 14px; font-weight: 500; transition: 0.3s; }
        nav a:hover { color: var(--white); text-decoration: underline; }
    #holiday-offers {
    background: #004d00; /* Festive Green */
    color: white;
    text-align: center;
    border: 5px dashed #d62300;
    margin: 20px;
    padding: 30px;
        }

        /* HERO SECTION */
        .hero { 
            height: 60vh; 
            background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url("https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80") center/cover no-repeat;
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 0 20px; color: var(--white);
        }
        .hero h1 { font-size: 3.5rem; margin: 0; font-weight: 700; letter-spacing: 1px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .hero p { font-size: 1.2rem; margin-top: 15px; opacity: 0.95; font-weight: 500; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }

        .hidden { display: none !important; }
        section { padding: 60px 10%; }

        /* BIKES SECTION */
        #bikes {
            background: url("https://thumbs.dreamstime.com/b/hand-drawn-motorcycle-doodle-set-vector-illustration-chopper-motorbike-custom-bike-biker-stuff-accessories-parts-garage-164661874.jpg") center/cover fixed no-repeat;
            background-color: var(--cream);
            background-blend-mode: overlay;
        }

        h2.cat-title { text-align: center; margin-bottom: 40px; color: var(--leather); font-size: 28px; text-transform: uppercase; letter-spacing: 2px; border-bottom: 2px solid var(--burnt-red); display: inline-block; padding-bottom: 10px; }
        .cat-container { text-align: center; margin-bottom: 20px; }

        /* CARDS */
        .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 30px; margin-bottom: 50px; }
        .card { background: var(--white); border-radius: 12px; overflow: hidden; transition: 0.4s; border: none; box-shadow: 0 5px 15px rgba(136, 81, 51, 0.1); }
        .card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(136, 81, 51, 0.2); }
        .card img { width: 100%; height: 190px; object-fit: cover; border-bottom: 4px solid var(--beige); }
        .card-content { padding: 20px; text-align: center; }
        .card h3 { margin: 10px 0; font-size: 18px; color: var(--leather); font-weight: 700; }
        .card p { color: var(--burnt-red); font-weight: bold; margin-bottom: 15px; font-size: 1.1rem; }
        
        .btn { background: var(--burnt-red); color: var(--white); border: none; padding: 12px; cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%; transition: 0.3s; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn:hover { background: #b01c00; box-shadow: 0 4px 10px rgba(214, 35, 0, 0.3); }

        /* DASHBOARD */
        .dashboard-container { 
            background: var(--white); padding: 40px; border-radius: 12px; max-width: 1000px; margin: 0 auto; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid var(--beige);
        }
        
        /* ADMIN PANEL - DARK THEME */
        .admin-panel { 
            background: #111;
            padding: 40px; border-radius: 12px; max-width: 1200px; margin: 0 auto; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-left: 5px solid var(--burnt-red);
            color: #ddd;
        }
        .admin-panel th { color: var(--burnt-red); text-align: left; padding: 15px; border-bottom: 1px solid #444; font-size:13px; text-transform:uppercase; letter-spacing:1px; }
        .admin-panel td { padding: 15px; border-bottom: 1px solid #333; color: #fff; font-size:14px; }

        .btn-csv { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-wipe { background: #b71c1c; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 10px; }

        /* FEEDBACK STYLE */
        .feedback-box { background: var(--white); padding: 30px; border-radius: 12px; max-width: 600px; margin: 0 auto; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 1px solid var(--beige); }
        .feedback-box input, .feedback-box textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; margin: 10px 0; font-family: inherit; box-sizing: border-box; }
        .rating-stars { font-size: 24px; color: #ddd; cursor: pointer; margin-bottom: 15px; }
        .rating-stars span.active { color: #ffcc00; }

        /* FOOTER */
        footer { background: var(--leather); color: var(--white); padding: 80px 20px 40px; text-align: center; border-top: 1px solid #6d4129; }
        .social-section { margin-bottom: 50px; }
        .social-section h2 { font-size: 32px; font-weight: bold; margin-bottom: 30px; display: inline-block; vertical-align: middle; margin-right: 30px; color: var(--beige); }
        .social-icons { display: inline-block; vertical-align: middle; }
        .social-icons img { width: 28px; margin: 0 15px; filter: invert(1); opacity: 0.8; transition: 0.3s; cursor: pointer; }
        .social-icons img:hover { opacity: 1; transform: translateY(-3px); }

        .footer-policies { margin-bottom: 40px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 40px; }
        .footer-policies a { color: var(--beige); text-decoration: none; margin: 0 20px; font-size: 16px; opacity: 0.9; }
        .footer-policies a:hover { color: var(--white); }
        .copyright { color: var(--text-muted); font-size: 15px; margin-bottom: 30px; }
        .footer-contact { color: rgba(255,255,255,0.7); font-size: 14px; max-width: 900px; margin: 0 auto; line-height: 1.8; }

        /* --- BOOKING POPUP --- */
        .popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:6000; backdrop-filter: blur(5px); }
        .popup-content { 
            background: #111; 
            width: 450px; 
            margin: 5% auto; 
            padding: 35px; 
            border-radius: 20px; 
            box-shadow: 0 20px 60px rgba(214, 35, 0, 0.2); 
            text-align: left;
            color: #ddd;
            border: 1px solid #333;
            position: relative;
        }
        
        .popup-content h3 { color: #fff; margin-top: 0; font-size: 18px; margin-bottom: 5px; }
        .form-label { display: block; font-size: 16px; color: #ddd; margin-bottom: 8px; font-weight: 500; }
        
        .city-select {
            width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #333; color: #ff5252; 
            border-radius: 8px; font-size: 18px; font-weight: bold; margin-bottom: 25px; outline: none;
        }
        
        .date-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        
        .date-input-group label { display: block; color: #888; font-size: 14px; margin-bottom: 5px; }
        .date-input { 
            width: 100%; padding: 10px; background: transparent; border: none; border-bottom: 1px solid #333; 
            color: #ff5252; font-size: 16px; box-sizing: border-box; font-family: inherit;
        }
        .date-input:focus { outline: none; border-bottom: 1px solid #ff5252; }
        
        .duration-box {
            background: #2a0e0e; color: #fff; padding: 15px; text-align: center; border-radius: 8px; 
            margin-top: 20px; font-weight: bold; border: 1px solid #5a1010; font-size: 18px;
        }

        .confirm-btn {
            background: #b71c1c; color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; 
            font-weight: bold; cursor: pointer; margin-top: 25px; font-size: 18px; transition: 0.3s;
            box-shadow: 0 5px 15px rgba(183, 28, 28, 0.3);
        }
        .confirm-btn:hover { background: #d32f2f; transform: translateY(-2px); }
        
        .close-icon {
            position: absolute; top: 20px; right: 20px; color: #555; cursor: pointer; font-size: 24px;
        }
        .close-icon:hover { color: #fff; }

        /* Search Bar */
        .search-bar { display: flex; gap: 10px; margin: 25px 0; }
        .search-bar input { flex: 1; padding: 12px; border-radius: 6px; border: 1px solid #ccc; }
        .search-btn { background: var(--leather); color: white; padding: 0 25px; border: none; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="login-card">
        <h2 id="auth-title" style="color:var(--leather); margin-top:0;">RentalDrive Login</h2>
        <p id="auth-subtitle" style="color:#666; font-size: 14px; margin-bottom: 20px;">Welcome back. Please login.</p>
        
        <div id="register-fields" class="hidden">
            <input type="text" id="regName" placeholder="Full Name">
        </div>
        <input type="email" id="authEmail" placeholder="Email Address">
        <input type="password" id="authPass" placeholder="Password">
        
        <button class="btn" id="auth-main-btn" onclick="handleAuth()">Enter Dashboard</button>
        
        <p style="font-size: 13px; margin-top: 15px; color: #666;">
            <span id="auth-toggle-text">Don't have an account?</span> 
            <a href="javascript:void(0)" onclick="toggleAuthMode()" id="auth-toggle-link" style="color: var(--burnt-red); font-weight: bold; text-decoration: none;">Register</a>
        </p>
    </div>
</div>

<div id="main-content" class="hidden">
    <header>
        <h2 onclick="location.reload()">RentalDrive</h2>
        <nav id="main-nav">
            <a href="#bikes">Bikes</a>
            <a href="#scooters">Scooters</a>
            <a href="#cars">Cars</a>
            <a href="#customer-portal">My Bookings</a>
            <a href="#feedback-section" id="nav-feedback" class="hidden">Feedback</a>
            <span id="dev-nav-link" class="hidden"><a href="#admin-panel">Developer Panel</a></span>
            <span class="logout-btn" style="cursor:pointer" onclick="location.reload()">Logout</span>
        </nav>
    </header>

    <div class="hero">
        <h1>Experience the Freedom of the Road</h1>
        <p>Premium cars and bikes for your next adventure.</p>
    </div>

    <section id="bikes">
        <div class="cat-container"><h2 class="cat-title">Bikes</h2></div>
        <div class="cards">
            <div class="card"><img src="https://imgd.aeplcdn.com/1056x594/n/ybfrphb_1881667.jpg?q=80"><div class="card-content"><h3>Yamaha MT-15</h3><p>â‚¹900/day</p><button class="btn" onclick="openForm('Yamaha MT-15',900)">Book Now</button></div></div>
            <div class="card"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR0iEh1MVJnEgKz53IIJjoj5txk4lfZ0ScJ3g&s"><div class="card-content"><h3>Royal Enfield Classic</h3><p>â‚¹800/day</p><button class="btn" onclick="openForm('Royal Enfield', 800)">Book Now</button></div></div>
            <div class="card"><img src="https://imgd.aeplcdn.com/664x374/n/cw/ec/1/versions/bajaj-pulsar-n160-dual-channel-abs1725031145215.jpg?q=80"><div class="card-content"><h3>Bajaj Pulsar 150</h3><p>â‚¹600/day</p><button class="btn" onclick="openForm('Pulsar 150', 600)">Book Now</button></div></div>
            <div class="card"><img src="https://imgd.aeplcdn.com/664x374/n/bw/models/colors/ktm-select-model-gp-edition-1670841965124.png?q=80"><div class="card-content"><h3>KTM RC 390</h3><p>â‚¹1,200/day</p><button class="btn" onclick="openForm('KTM Duke', 1200)">Book Now</button></div></div>
            <div class="card"><img src="https://imgd.aeplcdn.com/1056x594/n/ovv6seb_1777199.jpg?q=80"><div class="card-content"><h3>royal Enfield Interceptor 650</h3><p>â‚¹1750/day</p><button class="btn" onclick="openForm('Honda Hornet', 1750)">Book Now</button></div></div>
        </div>
    </section>

    <section id="scooters" style="background: var(--beige);">
        <div class="cat-container"><h2 class="cat-title">Scooters</h2></div>
        <div class="cards">
            <div class="card"><img src="https://imgd.aeplcdn.com/664x374/n/cw/ec/1/versions/--connected-obd-2b1737697110094.jpg?q=80"><div class="card-content"><h3>Honda Activa 6G</h3><p>â‚¹400/day</p><button class="btn" onclick="openForm('Honda Activa', 400)">Book Now</button></div></div>
            <div class="card"><img src="https://imgd.aeplcdn.com/1056x594/n/oz7vseb_1777485.jpg?q=80"><div class="card-content"><h3>TVS Ntorq 125</h3><p>â‚¹500/day</p><button class="btn" onclick="openForm('TVS Ntorq', 500)">Book Now</button></div></div>
            <div class="card"><img src="https://imgd.aeplcdn.com/664x374/n/cw/ec/1/versions/--standard1741335549558.jpg?q=80"><div class="card-content"><h3>BMW C400 GT</h3><p>â‚¹450/day</p><button class="btn" onclick="openForm('Suzuki Access', 450)">Book Now</button></div></div>
            <div class="card"><img src="https://imgd.aeplcdn.com/1056x594/n/bw/models/colors/ather-select-model-lunar-grey-1709794624354.png?q=80"><div class="card-content"><h3>ATHER 450X</h3><p>â‚¹600/day</p><button class="btn" onclick="openForm('Ola S1', 600)">Book Now</button></div></div>
            <div class="card"><img src="https://imgd.aeplcdn.com/664x374/n/cw/ec/49550/vxl-150-right-side-view-3.jpeg?isig=0&q=80"><div class="card-content"><h3>Vespa SXL 150</h3><p>â‚¹700/day</p><button class="btn" onclick="openForm('Vespa', 700)">Book Now</button></div></div>
        </div>
    </section>

    <section id="cars">
        <div class="cat-container"><h2 class="cat-title">Cars</h2></div>
        <div class="cards">
            <div class="card"><img src="https://imgd.aeplcdn.com/664x374/n/cw/ec/159099/swift-exterior-left-front-three-quarter-28.jpeg?isig=0&q=80"><div class="card-content"><h3>Maruti Swift</h3><p>â‚¹1,200/day</p><button class="btn" onclick="openForm('Maruti Swift',1200)">Book Now</button></div></div>
            <div class="card"><img src="https://stimg.cardekho.com/images/carexteriorimages/930x620/Toyota/Innova-Crysta/9608/1755846139274/front-left-side-47.jpg?tr=w-420"><div class="card-content"><h3>Innova Crysta</h3><p>â‚¹2,500/day</p><button class="btn" onclick="openForm('Innova Crysta', 2500)">Book Now</button></div></div>
            <div class="card"><img src="https://imgd-ct.aeplcdn.com/664x415/n/cw/ec/44709/fortuner-exterior-left-front-three-quarter-6.jpeg?isig=0&q=80"><div class="card-content"><h3>Toyota Fortuner</h3><p>â‚¹4,000/day</p><button class="btn" onclick="openForm('Toyota Fortuner', 4000)">Book Now</button></div></div>
            <div class="card"><img src="https://imgd-ct.aeplcdn.com/664x415/n/cw/ec/124839/thar-roxx-exterior-left-front-three-quarter-3.jpeg?isig=0&q=80"><div class="card-content"><h3>Mahindra Thar Rox</h3><p>â‚¹3,000/day</p><button class="btn" onclick="openForm('Mahindra Thar', 3000)">Book Now</button></div></div>
            <div class="card"><img src="https://www.jdmbuysell.com/wp-content/uploads/2020/03/Toyota-Supra-2-1.jpg"><div class="card-content"><h3>Toyota Supra</h3><p>â‚¹1,800/day</p><button class="btn" onclick="openForm('toyota Supra', 1800)">Book Now</button></div></div>
            <div class="card"><img src="https://res.cloudinary.com/unix-center/image/upload/c_limit,dpr_3.0,f_auto,fl_progressive,g_center,h_580,q_75,w_906/n20onzdjgzcnueh01av5.jpg"><div class="card-content"><h3>Range Rover</h3><p>â‚¹5,000/day</p><button class="btn" onclick="openForm('Range Rover', 5000)">Book Now</button></div></div>
        </div>
    </section>

    <section id="customer-portal" style="background: var(--beige);">
        <div class="dashboard-container">
            <h2 style="display:flex; align-items:center; gap:15px; color:var(--leather); border:none;"><span style="color:var(--burnt-red)">ðŸ‘¤</span> Track Your Bookings</h2>
            <p style="color:#666">Enter your full name to view your rental history.</p>
            <div class="search-bar">
                <input type="text" id="searchName" placeholder="Full name used during booking...">
                <button class="search-btn" onclick="viewHistory()">Search Records</button>
            </div>
            <table style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align:left; border-bottom:2px solid var(--beige)">
                        <th style="padding:10px">Vehicle</th>
                        <th style="padding:10px">Pickup Date</th>
                        <th style="padding:10px">Status</th>
                    </tr>
                </thead>
                <tbody id="historyData">
                    <tr><td colspan="3" style="text-align:center; padding:40px; color:#999;">No records to display.</td></tr>
                </tbody>
            </table>
        </div>
    </section>

    <section id="feedback-section" class="hidden">
        <div class="feedback-box">
            <h2 style="text-align:center; color: var(--leather);">How was your ride?</h2>
            <p style="text-align:center; color: #666;">We value your feedback!</p>
            
            <input type="email" id="feedbackEmail" placeholder="Your Email">
            <input type="text" id="feedbackMobile" placeholder="Mobile Number">

            <div class="rating-stars" id="starRating">
                <span onclick="setRating(1)">â˜…</span><span onclick="setRating(2)">â˜…</span><span onclick="setRating(3)">â˜…</span><span onclick="setRating(4)">â˜…</span><span onclick="setRating(5)">â˜…</span>
            </div>
            <textarea id="feedbackText" rows="4" placeholder="Share your experience with us..."></textarea>
            <button class="btn" onclick="submitFeedback()">Submit Feedback</button>
        </div>
    </section>

    <section id="holiday-offers">
        <div class="holiday-card">
            <h2>ðŸŽ„ Christmas & New Year Special Offers ðŸŽ†</h2>
            <p>Get up to 10% off on SUV rentals this December!</p>
        </div>
    </section>

    <section id="admin-panel" class="hidden">
        <div class="admin-panel">
            <h2 style="color:var(--burnt-red); border:none;">ðŸ›  Developer Management</h2>
            <div style="margin:30px 0;">
                <button class="btn-csv" onclick="exportCSV()">Download CSV</button>
                <button class="btn-wipe" onclick="clearData()">Wipe Database</button>
                <span style="margin-left:25px; color:#666">Import CSV: <input type="file" onchange="importCSV(event)"></span>
            </div>
            
            <h3>Recent Bookings</h3>
            <table style="width:100%; margin-bottom: 40px;">
                <thead>
                    <tr><th>Customer</th><th>Vehicle</th><th>City</th><th>Pickup</th><th>Drop</th><th>Duration</th><th>ID</th></tr>
                </thead>
                <tbody id="adminData"></tbody>
            </table>

            <h3 style="color: var(--burnt-red);">Customer Feedback</h3>
            <table style="width:100%;">
                <thead>
                    <tr><th>User Email</th><th>Mobile</th><th>Rating</th><th>Message</th><th>Date</th></tr>
                </thead>
                <tbody id="feedbackAdminData"></tbody>
            </table>
        </div>
    </section>

    <footer>
        <div class="social-section">
            <h2>Let's get social</h2>
            <div class="social-icons">
                <img src="https://cdn-icons-png.flaticon.com/512/20/20061.png" alt="FB">
                <img src="https://cdn-icons-png.flaticon.com/512/5969/5969020.png" alt="X">
                <img src="https://cdn-icons-png.flaticon.com/512/1384/1384063.png" alt="IG">
                <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YT">
                <img src="https://cdn-icons-png.flaticon.com/512/1384/1384014.png" alt="IN">
            </div>
        </div>
        <div class="footer-policies">
            <a href="#">Privacy Policy</a> â€¢ <a href="#">Terms of Use</a> â€¢ <a href="#">Warranty Policy</a> â€¢ <a href="#">D2D Paid Repair Service Policy</a>
        </div>
        <div class="copyright">
            Â© 2025 Imagine Marketing Limited. All Rights Reserved.
        </div>
        <div class="footer-contact">
            For queries contact us: Manager, Imagine Marketing Limited Unit no. 204 & 205, 2nd floor, D-wing & E-wing, Corporate Avenue, Andheri Ghatkopar Link Road, Mumbai, Maharashtra-400093, India
        </div>
    </footer>
</div>

<div id="popup" class="popup">
    <div class="popup-content">
        <span class="close-icon" onclick="document.getElementById('popup').style.display='none'">&times;</span>
        <h3 id="vName">Vehicle Name</h3>
        <label class="form-label">Choose your city</label>
        <select id="bookingCity" class="city-select">
            <option value="Bangalore">Bangalore</option>
            <option value="Mumbai">Mumbai</option>
            <option value="Delhi">Delhi</option>
            <option value="Chennai">Chennai</option>
            <option value="Hyderabad">Hyderabad</option>
        </select>
        <div class="date-grid">
            <div class="date-input-group"><label>Pick up date</label><input type="date" id="pickupDate" class="date-input" onchange="calcDuration()"></div>
            <div class="date-input-group"><label>Pick up time</label><input type="time" id="pickupTime" class="date-input" value="09:00"></div>
        </div>
        <div class="date-grid">
            <div class="date-input-group"><label>Drop date</label><input type="date" id="dropDate" class="date-input" onchange="calcDuration()"></div>
            <div class="date-input-group"><label>Drop time</label><input type="time" id="dropTime" class="date-input" value="21:00"></div>
        </div>
        <div id="durationText" class="duration-box">Duration: Select dates</div>
        <button class="confirm-btn" onclick="saveBooking()">Confirm Booking</button>
    </div>
</div>

<script>
    let activeUser = "";
    let userEmail = "";
    let curVehicle = "";
    let isRegisterMode = false;
    let currentPricePerDay = 0;
    let selectedRating = 0;

    function toggleAuthMode() {
        isRegisterMode = !isRegisterMode;
        document.getElementById('register-fields').classList.toggle('hidden');
    }

    function handleAuth() {
        const email = document.getElementById('authEmail').value;
        const pass = document.getElementById('authPass').value;
        userEmail = email;
        if(pass === "admin789") return enterDashboard("Developer", true);
        enterDashboard(email.split('@')[0] || "Guest", false);
    }

    // --- LOGIC 1: Only show feedback if user has purchased ---
    function checkFeedbackEligibility() {
        let db = JSON.parse(localStorage.getItem('rentals') || "[]");
        // Check if active user name exists in the rentals database
         let hasPurchased = db.some(record => record.name.toLowerCase() === activeUser.toLowerCase());
        
        const feedbackSec = document.getElementById('feedback-section');
        const navFeedback = document.getElementById('nav-feedback');

        if (hasPurchased) {
            feedbackSec.classList.remove('hidden');
            navFeedback.classList.remove('hidden');
        } else {
            feedbackSec.classList.add('hidden');
            navFeedback.classList.add('hidden');
        }
    }

    function enterDashboard(name, isAdmin) {
        activeUser = name;
        if(isAdmin) {
            document.getElementById('dev-nav-link').classList.remove('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            document.getElementById('holiday-offers').classList.add('hidden');
            document.getElementById('feedback-section').classList.add('hidden');
        } else {
            document.getElementById('holiday-offers').classList.remove('hidden');
            checkFeedbackEligibility(); // Check on login
        }
        document.getElementById('auth-overlay').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('feedbackEmail').value = userEmail;
        renderAdmin();
        renderFeedbackAdmin();
    }

    function setRating(n) {
        selectedRating = n;
        let stars = document.querySelectorAll('#starRating span');
        stars.forEach((s, i) => {
            s.classList.toggle('active', i < n);
        });
    }

    function openForm(v, p) {
        curVehicle = v; currentPricePerDay = p || 1000;
        document.getElementById('vName').innerText = v;
        document.getElementById('popup').style.display = "block";
    }

    // --- LOGIC 2: 10% Discount if bill > 1000 ---
    function calcDuration() {
        let p = document.getElementById('pickupDate').value;
        let d = document.getElementById('dropDate').value;
        if(p && d) {
            let days = Math.ceil((new Date(d) - new Date(p)) / (1000*60*60*24)) || 1;
            let subtotal = days * currentPricePerDay;
            let msg = "";

            if(subtotal > 1000) {
                subtotal = subtotal * 0.90; // 10% Off
                msg = "(10% Discount Applied)";
            }
            
            document.getElementById('durationText').innerText = `Duration: ${days} Days | Total: â‚¹${subtotal.toFixed(0)} ${msg}`;
        }
    }

    function saveBooking() {
        let db = JSON.parse(localStorage.getItem('rentals') || "[]");
        db.push({
            id: "BK-" + Math.floor(Math.random()*9000),
            name: activeUser,
            vehicle: curVehicle,
            date: document.getElementById('pickupDate').value,
            details: { city: document.getElementById('bookingCity').value, duration: document.getElementById('durationText').innerText }
        });
        localStorage.setItem('rentals', JSON.stringify(db));
        alert("Confirmed!");
        document.getElementById('popup').style.display = "none";
        
        // Refresh eligibility immediately after purchase
        checkFeedbackEligibility();
        renderAdmin();
    }

    function submitFeedback() {
        let msg = document.getElementById('feedbackText').value;
        let email = document.getElementById('feedbackEmail').value;
        let mobile = document.getElementById('feedbackMobile').value;

        if(!msg || selectedRating === 0 || !email || !mobile) return alert("Please fill all fields!");
        
        let fb = JSON.parse(localStorage.getItem('user_feedback') || "[]");
        fb.push({ 
            user: activeUser, 
            email: email,
            mobile: mobile,
            rating: selectedRating, 
            msg: msg, 
            date: new Date().toLocaleDateString() 
        });
        localStorage.setItem('user_feedback', JSON.stringify(fb));
        alert("Feedback Sent!");
        document.getElementById('feedbackText').value = "";
        document.getElementById('feedbackMobile').value = "";
        setRating(0);
        renderFeedbackAdmin();
    }

    function renderFeedbackAdmin() {
        let fb = JSON.parse(localStorage.getItem('user_feedback') || "[]");
        let html = "";
        fb.reverse().forEach(x => {
            html += `<tr><td>${x.email}</td><td>${x.mobile}</td><td>${x.rating} â˜…</td><td>${x.msg}</td><td>${x.date}</td></tr>`;
        });
        document.getElementById('feedbackAdminData').innerHTML = html || "<tr><td colspan='5'>No feedback yet.</td></tr>";
    }

    function renderAdmin() {
        let db = JSON.parse(localStorage.getItem('rentals') || "[]");
        let html = "";
        db.reverse().forEach(x => {
            html += `<tr><td>${x.name}</td><td>${x.vehicle}</td><td>${x.details.city}</td><td>${x.date}</td><td>-</td><td>${x.details.duration}</td><td>${x.id}</td></tr>`;
        });
        document.getElementById('adminData').innerHTML = html;
    }

    function viewHistory() {
        let name = document.getElementById('searchName').value.toLowerCase();
        let db = JSON.parse(localStorage.getItem('rentals') || "[]");
        let filtered = db.filter(x => x.name.toLowerCase() === name);
        let html = "";
        filtered.forEach(x => {
            html += `<tr><td>${x.vehicle}</td><td>${x.date}</td><td>Confirmed</td></tr>`;
        });
        document.getElementById('historyData').innerHTML = html || "<tr><td colspan='3'>No records.</td></tr>";
    }

    function clearData() { if(confirm("Clear?")) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
